import"./modulepreload-polyfill-B5Qt9EMX.js";import{S,C as A,H as U,a as b,R as C,b as D,L as x,E as F,c as $}from"./robot-eg90LYBI.js";const i=document.getElementById("preview"),t=i.getContext("2d"),E=document.getElementById("fwd"),v=document.getElementById("trn"),N=document.getElementById("fwdVal"),k=document.getElementById("trnVal"),p=document.getElementById("methodSelect"),K=document.getElementById("resetBtn"),V=document.getElementById("info"),G=document.getElementById("pidPanel"),T=document.getElementById("kp"),f=document.getElementById("ki"),M=document.getElementById("kd"),_=document.getElementById("kpVal"),L=document.getElementById("kiVal"),P=document.getElementById("kdVal"),O={robot:{initial_position:{x:10,y:25,angle:0,scale:1,width:0,height:0,wheelBase:0,wheelRadius:0,wheelWidth:0,leftPower:0,rightPower:0,maxSpeed:0,color:0,sensorColor:0,wheelColor:0,axleColor:0,sensor:0,status:0},wheel:{radius:27.5,interval:125},speed:{max_speed:.7},direction:{drive_direction_cnt:5}}};window.formData||(window.formData={setValue:(e,n)=>{},getValue:e=>null,renderRobot:()=>{}});function R(){t.clearRect(0,0,i.width,i.height),t.save(),t.strokeStyle="#eee";for(let e=0;e<=i.width;e+=50)t.beginPath(),t.moveTo(e,0),t.lineTo(e,i.height),t.stroke();for(let e=0;e<=i.height;e+=50)t.beginPath(),t.moveTo(0,e),t.lineTo(i.width,e),t.stroke();t.restore()}function J(e){switch(e){case"linear":return new x;case"revolution":return new $;case"edgepid":return new F;default:return new x}}function j(){return W(window.LEFTMOTOR)}function q(){return W(window.RIGHTMOTOR)}function W(e){var s;const n=Number(document.getElementById("ts").value)||.1,m=Number(document.getElementById("alpha").value)||1,r=Number(document.getElementById("beta").value)||.5,d=Number(document.getElementById("j").value)||.01,l=Number(document.getElementById("tauc").value)||.1,w=Number(document.getElementById("taul").value)||.1;e._emuState||(e._emuState={count:0,theta:0,omega:0});let u=e._emuState.theta,a=e._emuState.omega;const g=typeof e.getPWM=="function"?e.getPWM():0;return a+=n*(m*g-r*a-d*l*Math.sign(a)-d*w),u+=n*a,e._emuState.theta=u,e._emuState.omega=a,e._emuState.count+=u*(((s=window.robot)==null?void 0:s.maxSpeed)||1),e._emuState.theta=u,e._emuState.omega=a,window.robot&&(window.robot._simTheta=u,window.robot._simOmega=a),Math.floor(e._emuState.count)}async function z(e){const r=[];window.config||(window.config=O);const d=new S("leftPower"),l=new S("rightPower");window.LEFTMOTOR=d,window.RIGHTMOTOR=l,d.getCount=()=>j(),l.getCount=()=>q();const w=new A("C");window.COLORMONITOR=w;const u=new U(d,l);window.HWMONITOR=u,window.STATUSMONITOR&&(b.mSingleton=null),window.STATUSMONITOR=b.getInstance(),window.HWMONITOR.motorR===window.STATUSMONITOR.hwMonitor.motorR?console.log("HWMONITOR.motorR === STATUSMONITOR.hwMonitor.motorR"):console.log("HWMONITOR.motorR !== STATUSMONITOR.hwMonitor.motorR");const a={reset:()=>{},getCount:()=>0,setPWM:()=>{}},g=new C("robot",O);window.robot=g,J(e.method);const s={},I={FWD:e.fwd,TRN:e.trn,METHOD:5,Kp:e.kp,Ki:e.ki,Kd:e.kd},h=new D(d,l,a);window.formData||(window.formData={setValue:(y,B)=>{},getValue:y=>null,renderRobot:()=>{}});const H={linear:5,revolution:3,edgepid:1};h.commandSet={SNO:0,CNO:0,RunInfo:Object.assign({},I,{FUNCNO:H[e.method]||5,NOBLNCE:1})},h.setCalibrationInfo(s),h.changeRunMethod();for(let y=0;y<100;y++){h.run(),window.STATUSMONITOR.run();let B={};window.STATUSMONITOR.getCoordinateInfo(B),window.HWMONITOR.motorR===window.STATUSMONITOR.hwMonitor.motorR?console.log("HWMONITOR.motorR === STATUSMONITOR.hwMonitor.motorR"):console.log("HWMONITOR.motorR !== STATUSMONITOR.hwMonitor.motorR");const c=new C("robot",O);if(c.move(d.getCount(),l.getCount(),B.driveDirection,window.config.robot.initial_position.angle),r.push({x:c.x*10,y:c.y*10,a:c.angle}),c.x<0||c.x>i.width||c.y<0||c.y>i.height)break}return r}function Q(e){if(R(),!e||e.length===0)return;t.beginPath(),t.moveTo(e[0].x,e[0].y);for(const m of e)t.lineTo(m.x,m.y);t.strokeStyle="#0077cc",t.lineWidth=2,t.stroke(),t.fillStyle="red",t.beginPath();const n=e[e.length-1];e[e.length-5],t.moveTo(n.x,n.y),t.lineTo(n.x-Math.cos(n.a+Math.PI/6)*10,n.y-Math.sin(n.a+Math.PI/6)*10),t.lineTo(n.x-Math.cos(n.a-Math.PI/6)*10,n.y-Math.sin(n.a-Math.PI/6)*10),t.closePath(),t.fill(),V.textContent=`steps=${e.length} end=(x:${Math.round(n.x)}, y:${Math.round(n.y)}) angle=${n.a.toFixed(2)}`}function X(){return{method:p.value,fwd:Number(E.value),trn:Number(v.value),kp:Number(T.value),ki:Number(f.value),kd:Number(M.value)}}function o(){const e=X();z(e).then(Q)}E.addEventListener("input",()=>{N.textContent=E.value,o()});v.addEventListener("input",()=>{k.textContent=v.value,o()});T.addEventListener("input",()=>{_.textContent=T.value,o()});f.addEventListener("input",()=>{L.textContent=f.value,o()});M.addEventListener("input",()=>{P.textContent=M.value,o()});document.getElementById("ts").addEventListener("input",()=>{document.getElementById("tsVal").textContent=document.getElementById("ts").value,o()});document.getElementById("alpha").addEventListener("input",()=>{document.getElementById("alphaVal").textContent=document.getElementById("alpha").value,o()});document.getElementById("beta").addEventListener("input",()=>{document.getElementById("betaVal").textContent=document.getElementById("beta").value,o()});document.getElementById("j").addEventListener("input",()=>{document.getElementById("jVal").textContent=document.getElementById("j").value,o()});document.getElementById("tauc").addEventListener("input",()=>{document.getElementById("taucVal").textContent=document.getElementById("tauc").value,o()});document.getElementById("taul").addEventListener("input",()=>{document.getElementById("taulVal").textContent=document.getElementById("taul").value,o()});function Y(e){const n=Number(document.getElementById("ts").value)||.1,m=Number(document.getElementById("alpha").value)||1,r=Number(document.getElementById("beta").value)||.5,d=Number(document.getElementById("j").value)||.01,l=Number(document.getElementById("tauc").value)||.1,w=Number(document.getElementById("taul").value)||.1,u=typeof e.getPWM=="function"?e.getPWM():0;let a=e._emuState&&e._emuState.theta?e._emuState.theta:0,g=e._emuState&&e._emuState.omega?e._emuState.omega:0;document.getElementById("tsValSpan").textContent=n,document.getElementById("alphaValSpan").textContent=m,document.getElementById("betaValSpan").textContent=r,document.getElementById("jValSpan").textContent=d,document.getElementById("taucValSpan").textContent=l,document.getElementById("taulValSpan").textContent=w,document.getElementById("uValSpan").textContent=u;const s=document.getElementById("theta"),I=document.getElementById("omega");s&&(s.value=a,document.getElementById("thetaVal").textContent=Number(a).toFixed(3)),I&&(I.value=g,document.getElementById("omegaVal").textContent=Number(g).toFixed(3))}setInterval(()=>{window.LEFTMOTOR&&Y(window.LEFTMOTOR)},200);p.addEventListener("change",()=>{G.style.display=p.value==="edgepid"?"block":"none"});K.addEventListener("click",()=>{E.value=50,v.value=0,T.value=1,f.value=0,M.value=0,N.textContent="50",k.textContent="0",_.textContent="1.0",L.textContent="0.0",P.textContent="0.0",R(),V.textContent="",o()});R();o();
